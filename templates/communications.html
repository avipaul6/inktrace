<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ™ Communications Monitor - Inktrace</title>
    <link rel="stylesheet" href="/static/css/dashboard.css">
</head>
<body>
    <div class="app-layout">
        <!-- Modern Sidebar (Same as Dashboard) -->
        <div class="sidebar">
            <div class="logo">ğŸ™</div>
            <nav class="nav-items">
                <a href="/" class="nav-item" title="Dashboard">ğŸ </a>
                <a href="/communications" class="nav-item active" title="Communications">ğŸ“¡</a>
                <a href="/security-events" class="nav-item" title="Security Events">ğŸ›¡ï¸</a>
                <a href="/api/agents" target="_blank" class="nav-item" title="API">ğŸ”Œ</a>
            </nav>
            <div class="sidebar-bottom">
                <div class="user-avatar">JD</div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <h1 class="greeting">ğŸ“¡ Communications Monitor</h1>
                <div class="demo-controls">
                    <button class="demo-btn primary" onclick="refreshCommunications()">
                        ğŸ”„ Refresh
                    </button>
                    <button class="demo-btn secondary" onclick="window.location.href='/'">
                        ğŸ  Back to Dashboard
                    </button>
                </div>
            </div>

            <!-- Communications Content -->
            <div class="dashboard-layout" style="grid-template-columns: 1fr 1fr;">
                <!-- A2A Communications -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">ğŸ“¡</span>
                            A2A Communications
                        </div>
                        <div class="card-badge">Live</div>
                    </div>
                    <div id="communications-list">
                        <div class="empty-state">
                            <div class="empty-icon">ğŸ“¡</div>
                            <p>No A2A communications detected</p>
                            <p style="font-size: 0.8rem; color: #6b7280; margin-top: 0.5rem;">
                                Wiretap is actively monitoring agent communications
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Communication Stats -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">ğŸ“Š</span>
                            Communication Stats
                        </div>
                    </div>
                    <div class="intel-grid">
                        <div class="intel-item">
                            <div class="intel-label">Active Connections</div>
                            <div class="intel-value primary" id="active-connections">0</div>
                        </div>
                        <div class="intel-item">
                            <div class="intel-label">Messages Today</div>
                            <div class="intel-value" id="messages-today">0</div>
                        </div>
                        <div class="intel-item">
                            <div class="intel-label">Intercepted</div>
                            <div class="intel-value success" id="intercepted-count">0</div>
                        </div>
                        <div class="intel-item">
                            <div class="intel-label">Suspicious</div>
                            <div class="intel-value critical" id="suspicious-count">0</div>
                        </div>
                    </div>
                    
                    <div class="intel-status">ğŸ” Wiretap Active</div>
                    <div class="intel-status">ğŸ“Š Real-time Monitoring</div>
                </div>
            </div>

            <!-- Recent Communications Log -->
            <div class="dashboard-row-2">
                <div class="card" style="grid-column: 1 / -1;">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-icon">ğŸ“‹</span>
                            Recent Communications Log
                        </div>
                        <div class="card-badge">Last 24 hours</div>
                    </div>
                    <div id="communications-log">
                        <div class="empty-state">
                            <div class="empty-icon">ğŸ“</div>
                            <p>No communications logged yet</p>
                            <p style="font-size: 0.8rem; color: #6b7280; margin-top: 0.5rem;">
                                Communications will appear here as agents interact
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('ğŸ“¡ Inktrace Communications Monitor loaded');

        async function refreshCommunications() {
            try {
                const response = await fetch('/api/communications');
                const data = await response.json();
                updateCommunications(data);
            } catch (error) {
                console.error('Error refreshing communications:', error);
            }
        }

        function updateCommunications(data) {
            // Update stats
            document.getElementById('active-connections').textContent = data.active_connections || 0;
            document.getElementById('messages-today').textContent = data.messages_today || 0;
            document.getElementById('intercepted-count').textContent = data.intercepted_count || 0;
            document.getElementById('suspicious-count').textContent = data.suspicious_count || 0;

            // Update communications list
            const commsList = document.getElementById('communications-list');
            if (data.communications && data.communications.length > 0) {
                const commsHtml = data.communications.map(comm => `
                    <div class="agent-item">
                        <div class="agent-info">
                            <div class="agent-name">${comm.from} â†’ ${comm.to}</div>
                            <div class="agent-details">
                                <span>ğŸ“ ${comm.method}</span>
                                <span>â° ${new Date(comm.timestamp).toLocaleTimeString()}</span>
                                <span>ğŸ“Š ${comm.message_type}</span>
                            </div>
                        </div>
                        <div class="agent-metric ${comm.suspicious ? 'critical' : 'safe'}">
                            ${comm.suspicious ? 'Suspicious' : 'Safe'}
                        </div>
                    </div>
                `).join('');
                commsList.innerHTML = commsHtml;
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            refreshCommunications();
            setInterval(refreshCommunications, 5000);
        });
    </script>
</body>
</html>