<!DOCTYPE html>
<html>
<head>
    <title>🐙 Inktrace Communications Monitor</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/static/css/dashboard.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🐙 Inktrace Communications Monitor</h1>
            <div class="tagline">Real-time A2A protocol communication monitoring</div>
        </div>
        
        <nav class="nav">
            <a href="/">🏠 Dashboard</a>
            <a href="/communications" class="active">🔍 Communications</a>
            <a href="/security-events">📊 Security Events</a>
            <a href="/api/agents" target="_blank">🔌 API</a>
        </nav>
        
        <div class="card">
            <div class="card-title">
                <span class="card-title-icon">📡</span>
                Agent Communications
            </div>
            
            <div id="communications-list">
                {% if communications and communications|length > 0 %}
                    {% for comm in communications %}
                    <div class="recent-event event-info">
                        <div class="event-icon">📨</div>
                        <div class="event-content">
                            <div class="event-title">{{ comm.source_agent or 'Unknown' }} → {{ comm.target_agent or 'Unknown' }}</div>
                            <div class="event-description">
                                Method: {{ comm.method or 'N/A' }} | 
                                Status: {{ comm.status or 'N/A' }} | 
                                Response Time: {{ comm.response_time_ms or 0 }}ms
                            </div>
                            <div class="event-time">🕐 {{ comm.timestamp.strftime('%H:%M:%S') if comm.timestamp else 'Unknown' }}</div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                <div class="recent-event event-info">
                    <div class="event-icon">📡</div>
                    <div class="event-content">
                        <div class="event-title">NO COMMUNICATIONS DETECTED</div>
                        <div class="event-description">Agent communications will appear here when detected</div>
                        <div class="event-time">🕐 Monitoring active</div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <script src="/static/js/dashboard.js"></script>
    <script>
        // Auto-refresh communications every 3 seconds
        setInterval(async () => {
            try {
                const response = await fetch('/api/communications');
                const data = await response.json();
                updateCommunicationsList(data.communications || []);
            } catch (error) {
                console.error('Error refreshing communications:', error);
            }
        }, 3000);
        
        function updateCommunicationsList(communications) {
            const container = document.getElementById('communications-list');
            
            if (communications.length === 0) {
                container.innerHTML = `
                    <div class="recent-event event-info">
                        <div class="event-icon">📡</div>
                        <div class="event-content">
                            <div class="event-title">NO COMMUNICATIONS DETECTED</div>
                            <div class="event-description">Agent communications will appear here when detected</div>
                            <div class="event-time">🕐 Monitoring active</div>
                        </div>
                    </div>
                `;
                return;
            }
            
            const html = communications.reverse().map(comm => `
                <div class="recent-event event-info">
                    <div class="event-icon">📨</div>
                    <div class="event-content">
                        <div class="event-title">${comm.source_agent || 'Unknown'} → ${comm.target_agent || 'Unknown'}</div>
                        <div class="event-description">
                            Method: ${comm.method || 'N/A'} | 
                            Status: ${comm.status || 'N/A'} | 
                            Response Time: ${comm.response_time_ms || 0}ms
                        </div>
                        <div class="event-time">🕐 ${new Date(comm.timestamp).toLocaleTimeString()}</div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }
    </script>
</body>
</html>